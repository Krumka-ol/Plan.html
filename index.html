<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            width: 95%;
            max-width: 1200px;
            padding: 20px;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #1a73e8;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .audio-btn {
            background-color: #4CAF50;
            color: white;
            padding: 8px;
            border-radius: 9999px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        .audio-btn:hover {
            background-color: #45a049;
            transform: scale(1.1);
        }
        .visit-btn {
            background-color: #ef4444; /* red-500 */
            color: white;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 0.5rem; /* rounded-md */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
        }
        .visit-btn:hover {
            background-color: #dc2626; /* red-600 */
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="container bg-white rounded-xl p-8 shadow-2xl">
        <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">–ü–ª–∞–Ω –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ (2025-2027) üéì</h1>
        <p class="text-gray-600 mb-4 text-center">–ü–ª–∞–Ω –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–æ–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–æ —Ç–µ–º–µ. üí°</p>
        <p class="text-gray-600 mb-8 text-center">–î–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∞–π—Ç <a href="https://math-ege.sdamgia.ru/" target="_blank" class="text-red-500 font-semibold hover:underline">–†–µ—à—É –ï–ì–≠</a>. üöÄ</p>
        
        <div class="overflow-x-auto rounded-lg shadow-md mb-8">
            <table id="planTable" class="w-full text-left text-sm text-gray-500 rounded-lg">
                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3">
                            –¢–µ–º–∞ üìö
                        </th>
                        <th scope="col" class="px-6 py-3">
                            –ü–µ—Ä–∏–æ–¥ üóìÔ∏è
                        </th>
                        <th scope="col" class="px-6 py-3">
                            –ó–∞–¥–∞–Ω–∏—è –ï–ì–≠ ‚úÖ
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–ë–∞–∑–æ–≤—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –ü–æ–≤—Ç–æ—Ä –±–∞–∑–æ–≤–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                        </th>
                        <td class="px-6 py-4">
                            –ê–≤–≥—É—Å—Ç-–°–µ–Ω—Ç—è–±—Ä—å 2025
                        </td>
                        <td class="px-6 py-4">
                            -
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–ü–ª–∞–Ω–∏–º–µ—Ç—Ä–∏—è">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –ü–ª–∞–Ω–∏–º–µ—Ç—Ä–∏—è (–Ω–æ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã, —É–≥–ª—É–±–ª–µ–Ω–Ω–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ)
                        </th>
                        <td class="px-6 py-4">
                            1-2 –Ω–µ–¥–µ–ª—è –°–µ–Ω—Ç—è–±—Ä—è 2025
                        </td>
                        <td class="px-6 py-4">
                            1
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–í–µ–∫—Ç–æ—Ä—ã">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –í–µ–∫—Ç–æ—Ä—ã (–Ω–æ–≤—ã–µ —Ñ–æ—Ä–º—É–ª—ã, –Ω–æ–≤—ã–π —Å—á–µ—Ç, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ)
                        </th>
                        <td class="px-6 py-4">
                            –°–µ–Ω—Ç—è–±—Ä—å-–û–∫—Ç—è–±—Ä—å 2025
                        </td>
                        <td class="px-6 py-4">
                            2
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–°—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä–∏—è">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –°—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä–∏—è (–Ω–æ–≤–æ–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ, —Ñ–æ—Ä–º—É–ª—ã)
                        </th>
                        <td class="px-6 py-4">
                            –û–∫—Ç—è–±—Ä—å-–ù–æ—è–±—Ä—å 2025
                        </td>
                        <td class="px-6 py-4">
                            3
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
                        </th>
                        <td class="px-6 py-4">
                            –°–µ–Ω—Ç—è–±—Ä—å-–ù–æ—è–±—Ä—å 2025
                        </td>
                        <td class="px-6 py-4">
                            4, 5
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–£—Ä–∞–≤–Ω–µ–Ω–∏—è">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –£—Ä–∞–≤–Ω–µ–Ω–∏—è
                        </th>
                        <td class="px-6 py-4">
                            –°–µ–Ω—Ç—è–±—Ä—å 2025 - –ú–∞—Ä—Ç 2026
                        </td>
                        <td class="px-6 py-4">
                            6
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–í—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –í—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
                        </th>
                        <td class="px-6 py-4">
                            –°–µ–Ω—Ç—è–±—Ä—å 2025 - –ú–∞—Ä—Ç 2026
                        </td>
                        <td class="px-6 py-4">
                            7
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è –∏ –ø–µ—Ä–≤–æ–æ–±—Ä–∞–∑–Ω–∞—è">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –ü—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è –∏ –ø–µ—Ä–≤–æ–æ–±—Ä–∞–∑–Ω–∞—è
                        </th>
                        <td class="px-6 py-4">
                            –° –§–µ–≤—Ä–∞–ª—è 2026
                        </td>
                        <td class="px-6 py-4">
                            8
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–ù–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –ú–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ —Ä–∞–∑–Ω—ã—Ö –≤–∏–¥–æ–≤
                        </th>
                        <td class="px-6 py-4">
                            –°–µ–Ω—Ç—è–±—Ä—å 2025 - –ú–∞—Ä—Ç 2026
                        </td>
                        <td class="px-6 py-4">
                            9
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
                        </th>
                        <td class="px-6 py-4">
                            –°–µ–Ω—Ç—è–±—Ä—å 2025 - –ê–ø—Ä–µ–ª—å 2026; –°–µ–Ω—Ç—è–±—Ä—å 2026 - –ú–∞–π 2027
                        </td>
                        <td class="px-6 py-4">
                            10
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–ì—Ä–∞—Ñ–∏–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –ì—Ä–∞—Ñ–∏–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π
                        </th>
                        <td class="px-6 py-4">
                            –°–µ–Ω—Ç—è–±—Ä—å 2025 - –ú–∞—Ä—Ç 2026
                        </td>
                        <td class="px-6 py-4">
                            11, 12
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –ü–æ–≤—Ç–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                        </th>
                        <td class="px-6 py-4">
                            –ù–∞—á–∞–ª–æ –ê–≤–≥—É—Å—Ç–∞ 2026
                        </td>
                        <td class="px-6 py-4">
                            -
                        </td>
                    </tr>
                    <tr class="bg-white border-b cursor-pointer hover:bg-gray-50 transition-colors" data-topic="–í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å">
                        <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                            –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ 2-–π —á–∞—Å—Ç–∏
                        </th>
                        <td class="px-6 py-4">
                            –°–µ–Ω—Ç—è–±—Ä—å 2026 - –ú–∞–π 2027
                        </td>
                        <td class="px-6 py-4">
                            13, 14, 15, 16, 17, 18, 19
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="mt-8 bg-gray-100 p-6 rounded-lg shadow-inner flex flex-col items-center justify-center">
            <h2 class="text-xl font-semibold mb-4 text-gray-800 text-center">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∞–π—Ç "–†–µ—à—É –ï–ì–≠" –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á üìù</h2>
            <a href="https://math-ege.sdamgia.ru/" target="_blank" class="visit-btn flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                </svg>
                –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç
            </a>
        </div>

        <h2 class="text-xl font-semibold mt-8 mb-4 text-gray-800">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ‚ú®</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- –°–µ–∫—Ü–∏—è —Å —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ –æ–±—É—á–µ–Ω–∏—é -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">–ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç—ã –ø–æ –æ–±—É—á–µ–Ω–∏—é üß†</h2>
                <div class="flex flex-col sm:flex-row gap-4 mb-4">
                    <input type="text" id="topicInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É (–Ω–∞–ø—Ä. '—Å—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä–∏—è')" class="flex-1 p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="getTipsBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md transition-colors">
                        –ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç ‚ú®
                    </button>
                </div>
                <div id="tipResult" class="mt-4 p-4 bg-white rounded-md border border-gray-200 hidden">
                    <p id="tipText" class="text-gray-700"></p>
                    <button id="tipAudioBtn" class="audio-btn mt-2 hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path d="M11.5 5.25a.75.75 0 0 1 .75-.75H20.25a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H12.25a.75.75 0 0 1-.75-.75v-2.639a4.458 4.458 0 0 0 .5-6.521V5.25ZM10.25 10.75a1 1 0 0 0 0 2h-1.5a1 1 0 0 0 0-2h1.5Z" />
                            <path fill-rule="evenodd" d="M9.196 4.549a1.5 1.5 0 0 0-1.88-1.545l-.47.117A3 3 0 0 0 4.106 5.8L2.25 12.374a3 3 0 0 0 1.03 3.255l1.096.71a.75.75 0 0 1 .154.912l-.084.148a.75.75 0 0 1-.9.23l-1.637-.621A4.5 4.5 0 0 1 1.75 14.078V11.25a1 1 0 0 1 2 0v2.828a.5.5 0 0 0 .17.379l.995.645A1.5 1.5 0 0 0 7.196 15.45l.47-.117a1.5 1.5 0 0 0 1.88 1.545l3.25-1.125a.75.75 0 0 0 .428-.669V7.525a.75.75 0 0 0-.428-.669L9.196 4.55Z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <div id="tipLoading" class="hidden flex justify-center items-center mt-4">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ -->
            <div class="bg-gray-50 p-6 rounded-lg shadow-inner">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–æ —Ç–µ–º–µ üó∫Ô∏è</h2>
                <p class="text-gray-600 mb-4 text-sm">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Ç–µ–º! üëá</p>
                <div id="detailedPlan" class="mt-4 p-4 bg-white rounded-md border border-gray-200 hidden">
                    <p class="font-bold text-lg mb-2 text-gray-800">–ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è: <span id="detailedTopicName"></span></p>
                    <ul id="planDetailsList" class="list-disc list-inside text-gray-700"></ul>
                    <button id="planAudioBtn" class="audio-btn mt-2 hidden">
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path d="M11.5 5.25a.75.75 0 0 1 .75-.75H20.25a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H12.25a.75.75 0 0 1-.75-.75v-2.639a4.458 4.458 0 0 0 .5-6.521V5.25ZM10.25 10.75a1 1 0 0 0 0 2h-1.5a1 1 0 0 0 0-2h1.5Z" />
                            <path fill-rule="evenodd" d="M9.196 4.549a1.5 1.5 0 0 0-1.88-1.545l-.47.117A3 3 0 0 0 4.106 5.8L2.25 12.374a3 3 0 0 0 1.03 3.255l1.096.71a.75.75 0 0 1 .154.912l-.084.148a.75.75 0 0 1-.9.23l-1.637-.621A4.5 4.5 0 0 1 1.75 14.078V11.25a1 1 0 0 1 2 0v2.828a.5.5 0 0 0 .17.379l.995.645A1.5 1.5 0 0 0 7.196 15.45l.47-.117a1.5 1.5 0 0 0 1.88 1.545l3.25-1.125a.75.75 0 0 0 .428-.669V7.525a.75.75 0 0 0-.428-.669L9.196 4.55Z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <div id="planLoading" class="hidden flex justify-center items-center mt-4">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á -->
            <div class="mt-8 bg-gray-50 p-6 rounded-lg shadow-inner md:col-span-2">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á üìöüñäÔ∏è</h2>
                <div class="flex flex-col sm:flex-row gap-4 mb-4">
                    <input type="text" id="problemTopicInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É (–Ω–∞–ø—Ä. '—Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è')" class="flex-1 p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="generateProblemBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-md transition-colors">
                        –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É ‚ûï
                    </button>
                </div>
                <div id="problemResult" class="mt-4 p-4 bg-white rounded-md border border-gray-200 hidden">
                    <p id="problemText" class="text-gray-700"></p>
                    <button id="problemAudioBtn" class="audio-btn mt-2 hidden">
                         <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path d="M11.5 5.25a.75.75 0 0 1 .75-.75H20.25a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H12.25a.75.75 0 0 1-.75-.75v-2.639a4.458 4.458 0 0 0 .5-6.521V5.25ZM10.25 10.75a1 1 0 0 0 0 2h-1.5a1 1 0 0 0 0-2h1.5Z" />
                            <path fill-rule="evenodd" d="M9.196 4.549a1.5 1.5 0 0 0-1.88-1.545l-.47.117A3 3 0 0 0 4.106 5.8L2.25 12.374a3 3 0 0 0 1.03 3.255l1.096.71a.75.75 0 0 1 .154.912l-.084.148a.75.75 0 0 1-.9.23l-1.637-.621A4.5 4.5 0 0 1 1.75 14.078V11.25a1 1 0 0 1 2 0v2.828a.5.5 0 0 0 .17.379l.995.645A1.5 1.5 0 0 0 7.196 15.45l.47-.117a1.5 1.5 0 0 0 1.88 1.545l3.25-1.125a.75.75 0 0 0 .428-.669V7.525a.75.75 0 0 0-.428-.669L9.196 4.55Z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
                <div id="problemLoading" class="hidden flex justify-center items-center mt-4">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // UI elements
            const getTipsBtn = document.getElementById('getTipsBtn');
            const topicInput = document.getElementById('topicInput');
            const tipResult = document.getElementById('tipResult');
            const tipText = document.getElementById('tipText');
            const tipLoading = document.getElementById('tipLoading');
            const tipAudioBtn = document.getElementById('tipAudioBtn');
            
            const detailedPlan = document.getElementById('detailedPlan');
            const detailedTopicName = document.getElementById('detailedTopicName');
            const planDetailsList = document.getElementById('planDetailsList');
            const planLoading = document.getElementById('planLoading');
            const planAudioBtn = document.getElementById('planAudioBtn');
            
            const problemTopicInput = document.getElementById('problemTopicInput');
            const generateProblemBtn = document.getElementById('generateProblemBtn');
            const problemResult = document.getElementById('problemResult');
            const problemText = document.getElementById('problemText');
            const problemLoading = document.getElementById('problemLoading');
            const problemAudioBtn = document.getElementById('problemAudioBtn');

            const planTable = document.getElementById('planTable');

            // --- Helper functions for TTS ---
            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            }

            function pcmToWav(pcmData, sampleRate) {
                const buffer = new ArrayBuffer(44 + pcmData.length * 2);
                const view = new DataView(buffer);
                const pcm16 = new Int16Array(pcmData);

                // RIFF chunk descriptor
                writeString(view, 0, 'RIFF');
                view.setUint32(4, 36 + pcmData.length * 2, true);
                writeString(view, 8, 'WAVE');

                // fmt sub-chunk
                writeString(view, 12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true); // Linear PCM
                view.setUint16(22, 1, true); // Mono
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * 2, true);
                view.setUint16(32, 2, true);
                view.setUint16(34, 16, true); // 16 bits per sample

                // data sub-chunk
                writeString(view, 36, 'data');
                view.setUint32(40, pcmData.length * 2, true);

                // Write PCM data
                for (let i = 0; i < pcm16.length; i++) {
                    view.setInt16(44 + i * 2, pcm16[i], true);
                }

                return new Blob([view], { type: 'audio/wav' });
            }

            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }

            // --- Gemini API functions ---

            // Function to generate study tip
            async function generateStudyTip() {
                const prompt = `–î–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π, –ø–æ–ª–µ–∑–Ω—ã–π –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–æ–≤–µ—Ç –ø–æ –∏–∑—É—á–µ–Ω–∏—é –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –Ω–∞ —Ç–µ–º—É "${topicInput.value}". –°–æ–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –≤–∏–¥–µ –æ–¥–Ω–æ–≥–æ-–¥–≤—É—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≤—ã–∫–æ–≤.`;
                
                tipResult.classList.add('hidden');
                tipLoading.classList.remove('hidden');
                tipAudioBtn.classList.add('hidden');

                const chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    const text = result.candidates[0].content.parts[0].text;
                    tipText.textContent = text;
                    tipResult.classList.remove('hidden');
                    tipAudioBtn.classList.remove('hidden');
                } catch (error) {
                    console.error('Error fetching study tip:', error);
                    tipText.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
                    tipResult.classList.remove('hidden');
                } finally {
                    tipLoading.classList.add('hidden');
                }
            }
            
            // Function to generate detailed plan
            async function generateDetailedPlan(topic) {
                const prompt = `–†–∞–∑–±–µ–π —Ç–µ–º—É "${topic}" –∏–∑ –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –Ω–∞ 5-7 –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–¥—Ç–µ–º –∏–ª–∏ —à–∞–≥–æ–≤ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è. –û—Ç–≤–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤—å –≤ –≤–∏–¥–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫.`;
                
                detailedPlan.classList.add('hidden');
                planLoading.classList.remove('hidden');
                planAudioBtn.classList.add('hidden');
                
                detailedTopicName.textContent = topic;
                planDetailsList.innerHTML = '';

                const chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const text = result.candidates[0].content.parts[0].text;
                    
                    // Parse bulleted list
                    const listItems = text.split('\n').filter(item => item.trim() !== '');
                    listItems.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = item.replace(/^- /, '').replace(/^\* /, '').trim();
                        planDetailsList.appendChild(li);
                    });

                    detailedPlan.classList.remove('hidden');
                    planAudioBtn.classList.remove('hidden');
                } catch (error) {
                    console.error('Error fetching detailed plan:', error);
                    planDetailsList.innerHTML = '<li>–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.</li>';
                    detailedPlan.classList.remove('hidden');
                } finally {
                    planLoading.classList.add('hidden');
                }
            }

            // Function to generate practice problem
            async function generatePracticeProblem() {
                const prompt = `–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –æ–¥–Ω—É —Å–ª–æ–∂–Ω—É—é –∑–∞–¥–∞—á—É –ø–æ –ø—Ä–æ—Ñ–∏–ª—å–Ω–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –Ω–∞ —Ç–µ–º—É "${problemTopicInput.value}". –í–∫–ª—é—á–∏ –≤ –∑–∞–¥–∞—á—É –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –µ–µ —Ä–µ—à–µ–Ω–∏—è. –ù–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–π —Ä–µ—à–µ–Ω–∏–µ, —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É –∑–∞–¥–∞—á–∏. –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –∑–∞–¥–∞—á–∞ —É–Ω–∏–∫–∞–ª—å–Ω–∞.`;
                
                problemResult.classList.add('hidden');
                problemLoading.classList.remove('hidden');
                problemAudioBtn.classList.add('hidden');

                const chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const text = result.candidates[0].content.parts[0].text;
                    problemText.textContent = text;
                    problemResult.classList.remove('hidden');
                    problemAudioBtn.classList.remove('hidden');
                } catch (error) {
                    console.error('Error fetching practice problem:', error);
                    problemText.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
                    problemResult.classList.remove('hidden');
                } finally {
                    problemLoading.classList.add('hidden');
                }
            }

            // Function to generate and play TTS
            async function generateAndPlayTTS(textToSpeak) {
                const payload = {
                    contents: [{
                        parts: [{ text: textToSpeak }]
                    }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: {
                                prebuiltVoiceConfig: { voiceName: "Puck" }
                            }
                        }
                    },
                    model: "gemini-2.5-flash-preview-tts"
                };
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/")) {
                        const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        const audioUrl = URL.createObjectURL(wavBlob);
                        
                        const audio = new Audio(audioUrl);
                        audio.play();
                    } else {
                        throw new Error('Invalid audio data from API');
                    }
                } catch (error) {
                    console.error('Error generating and playing TTS:', error);
                }
            }

            // Event handlers
            getTipsBtn.addEventListener('click', generateStudyTip);
            generateProblemBtn.addEventListener('click', generatePracticeProblem);

            tipAudioBtn.addEventListener('click', () => {
                generateAndPlayTTS(tipText.textContent);
            });
            planAudioBtn.addEventListener('click', () => {
                let textToSpeak = `–ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è ${detailedTopicName.textContent}. `;
                const listItems = planDetailsList.getElementsByTagName('li');
                for (let i = 0; i < listItems.length; i++) {
                    textToSpeak += listItems[i].textContent + '. ';
                }
                generateAndPlayTTS(textToSpeak);
            });
            problemAudioBtn.addEventListener('click', () => {
                generateAndPlayTTS(problemText.textContent);
            });

            // Handle table row clicks
            planTable.querySelectorAll('tbody tr').forEach(row => {
                row.addEventListener('click', () => {
                    const topic = row.getAttribute('data-topic');
                    if (topic) {
                        generateDetailedPlan(topic);
                    }
                });
            });
        });
    </script>
</body>
</html>
